# Festo MPS é¢œè‰²ç®¡ç†ç³»ç»Ÿ

## ğŸ¨ æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸ºFesto MPS Distribution Stationæ·»åŠ äº†å®Œæ•´çš„å¤šé¢œè‰²å·¥ä»¶ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒé»‘è‰²ã€çº¢è‰²ã€é“¶è‰²ä¸‰ç§å·¥ä»¶çš„æ™ºèƒ½åˆ†é…å’Œè¿½è¸ªã€‚

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. å¤šé¢œè‰²å·¥ä»¶æ”¯æŒ
- **ä¸‰ç§æ ‡å‡†é¢œè‰²**: é»‘è‰² (black)ã€çº¢è‰² (red)ã€é“¶è‰² (silver)
- **çµæ´»é…ç½®**: æ”¯æŒä»»æ„æ•°é‡é¢œè‰²çš„æ‰©å±•
- **æ™ºèƒ½é€‰æ‹©**: æŒ‰ç…§å…ˆè¿›å…ˆå‡ºåŸåˆ™è‡ªåŠ¨é€‰æ‹©ä¸‹ä¸€ä¸ªå·¥ä»¶é¢œè‰²

### 2. æ™ºèƒ½è¡¥æ–™ç³»ç»Ÿ
- **è‡ªåŠ¨å¹³è¡¡åˆ†é…**: é»˜è®¤è¡¥æ–™æ—¶è‡ªåŠ¨å¹³è¡¡å„é¢œè‰²å·¥ä»¶æ•°é‡
- **è‡ªå®šä¹‰é…æ¯”**: æ”¯æŒç”¨æˆ·æŒ‡å®šå„é¢œè‰²å·¥ä»¶çš„ç²¾ç¡®æ•°é‡
- **å®æ—¶éªŒè¯**: è¡¥æ–™æ—¶è‡ªåŠ¨éªŒè¯æ€»æ•°é‡å’Œé¢œè‰²åˆ†é…çš„åˆç†æ€§

### 3. å¢å¼ºçš„ç”¨æˆ·ç•Œé¢
- **é¢œè‰²çŠ¶æ€æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºå„é¢œè‰²å·¥ä»¶çš„åº“å­˜æƒ…å†µ
- **å½“å‰å·¥ä»¶è¿½è¸ª**: æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„å·¥ä»¶é¢œè‰²
- **è‡ªå®šä¹‰è¡¥æ–™é¢æ¿**: æä¾›ç›´è§‚çš„é¢œè‰²é…æ¯”è®¾ç½®ç•Œé¢

### 4. è¯¦ç»†çš„æ—¥å¿—è®°å½•
- **é¢œè‰²ä¿¡æ¯é›†æˆ**: æ‰€æœ‰æ—¥å¿—è¾“å‡ºéƒ½åŒ…å«å½“å‰é¢œè‰²åˆ†å¸ƒä¿¡æ¯
- **å·¥ä»¶è¿½è¸ª**: è®°å½•æ¯ä¸ªå¼¹å‡ºå·¥ä»¶çš„å…·ä½“é¢œè‰²
- **æ“ä½œå†å²**: å®Œæ•´è®°å½•è¡¥æ–™å’Œé¢œè‰²å˜æ›´æ“ä½œ

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨ç³»ç»Ÿ
```bash
python festo.py
```

### åŸºæœ¬æ“ä½œ

#### 1. æŸ¥çœ‹å½“å‰çŠ¶æ€
- åœ¨æ§åˆ¶é¢æ¿çš„"Status"åŒºåŸŸæŸ¥çœ‹ï¼š
  - `Current Workpieces`: æ€»å·¥ä»¶æ•°
  - `Color Distribution`: å„é¢œè‰²å·¥ä»¶åˆ†å¸ƒ (æ ¼å¼: black:3 | red:2 | silver:1)
  - `Current Color Workpiece`: å½“å‰å¤„ç†çš„å·¥ä»¶é¢œè‰²

#### 2. é¢œè‰²é…æ¯”è¡¥æ–™ (ç®€åŒ–ç•Œé¢)
1. ç¡®ä¿æ–™ä»“ä¸ºç©º (ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥)
2. åœ¨"Color Distribution"åŒºåŸŸè®¾ç½®å„é¢œè‰²æ•°é‡ï¼š
   - **Black**: è®¾ç½®é»‘è‰²å·¥ä»¶æ•°é‡ (é»˜è®¤: 3)
   - **Red**: è®¾ç½®çº¢è‰²å·¥ä»¶æ•°é‡ (é»˜è®¤: 3)
   - **Silver**: è®¾ç½®é“¶è‰²å·¥ä»¶æ•°é‡ (é»˜è®¤: 2)
3. ç‚¹å‡»å³ä¾§çš„"Manual Refill"æŒ‰é’®
4. ç³»ç»ŸæŒ‰æŒ‡å®šé…æ¯”è¡¥æ–™

**ç•Œé¢å¸ƒå±€**: `Black: [3] Red: [3] Silver: [2] [Manual Refill]` (æŒ‰é’®ä¸Exitå¯¹é½)

### ç¼–ç¨‹æ¥å£

#### åŸºæœ¬é¢œè‰²ç®¡ç†
```python
# è·å–ä¸‹ä¸€ä¸ªå·¥ä»¶é¢œè‰²
next_color = station.get_next_workpiece_color()

# å¼¹å‡ºå·¥ä»¶ (è‡ªåŠ¨é€‰æ‹©é¢œè‰²)
if station.eject_workpiece():
    current_color = station.current_workpiece_color
    print(f"å¼¹å‡ºå·¥ä»¶é¢œè‰²: {current_color}")

# è·å–é¢œè‰²åˆ†å¸ƒæ‘˜è¦
color_summary = station.get_color_summary()
print(f"å½“å‰åˆ†å¸ƒ: {color_summary}")
```

#### è¡¥æ–™æ“ä½œ
```python
# é¢œè‰²é…æ¯”è¡¥æ–™ (æ¨èæ–¹å¼)
color_distribution = {'black': 3, 'red': 3, 'silver': 2}
station.manual_refill(8, color_distribution)

# è‡ªå®šä¹‰é…æ¯”ç¤ºä¾‹
color_distribution = {'black': 5, 'red': 2, 'silver': 1}
station.manual_refill(8, color_distribution)

# è‡ªåŠ¨å¹³è¡¡è¡¥æ–™ (ä»ç„¶æ”¯æŒï¼Œä½†ç•Œé¢ä¸å†ä½¿ç”¨)
station.manual_refill(8)  # è‡ªåŠ¨å¹³è¡¡åˆ†é…
```

#### é¢œè‰²é…ç½®æ‰©å±•
```python
# æ·»åŠ æ–°é¢œè‰²
station.available_colors.append('blue')
station.workpiece_colors['blue'] = 0

# ä½¿ç”¨æ–°é¢œè‰²
new_distribution = {'black': 2, 'red': 2, 'blue': 4}
station.manual_refill(8, new_distribution)
```

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ•°æ®ç»“æ„
```python
# é¢œè‰²ç®¡ç†å±æ€§
self.available_colors = ['black', 'red', 'silver']
self.workpiece_colors = {
    'black': 3,   # å„é¢œè‰²å·¥ä»¶æ•°é‡
    'red': 3,
    'silver': 2
}
self.current_workpiece_color = None  # å½“å‰å¤„ç†å·¥ä»¶é¢œè‰²
```

### å…³é”®æ–¹æ³•
- `get_next_workpiece_color()`: è·å–ä¸‹ä¸€ä¸ªå¯ç”¨å·¥ä»¶é¢œè‰²
- `eject_workpiece()`: å¼¹å‡ºå·¥ä»¶å¹¶æ›´æ–°é¢œè‰²åº“å­˜
- `get_color_summary()`: ç”Ÿæˆé¢œè‰²åˆ†å¸ƒæ‘˜è¦å­—ç¬¦ä¸²
- `_distribute_colors_evenly()`: è‡ªåŠ¨å¹³è¡¡é¢œè‰²åˆ†é…
- `_set_color_distribution()`: è®¾ç½®è‡ªå®šä¹‰é¢œè‰²åˆ†é…

## ğŸ§ª æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š
```bash
python test_color_management.py
```

æµ‹è¯•è¦†ç›–ï¼š
- âœ… åˆå§‹é¢œè‰²åˆ†å¸ƒ
- âœ… å·¥ä»¶å¼¹å‡ºå’Œé¢œè‰²é€‰æ‹©
- âœ… è‡ªåŠ¨å¹³è¡¡è¡¥æ–™
- âœ… è‡ªå®šä¹‰é¢œè‰²é…æ¯”è¡¥æ–™
- âœ… è¾¹ç•Œæ¡ä»¶å¤„ç†
- âœ… é¢œè‰²é…ç½®æ‰©å±•æ€§
- âœ… Testing Stationé›†æˆæ¼”ç¤º

## ğŸ”® åç»­æ‰©å±•

### Testing Station é›†æˆ
```python
class TestingStation(BaseStation):
    def detect_color(self, workpiece):
        """é¢œè‰²æ£€æµ‹é€»è¾‘"""
        # å®ç°é¢œè‰²æ£€æµ‹ç®—æ³•
        pass

    def quality_assessment_by_color(self, color):
        """åŸºäºé¢œè‰²çš„è´¨é‡æ ‡å‡†"""
        color_standards = {
            'black': {'tolerance': 0.1, 'pass_rate': 0.95},
            'red': {'tolerance': 0.05, 'pass_rate': 0.90},
            'silver': {'tolerance': 0.02, 'pass_rate': 0.98}
        }
        return color_standards.get(color, color_standards['black'])
```

### Processing Station å·®å¼‚åŒ–å¤„ç†
```python
class ProcessingStation(BaseStation):
    def get_processing_parameters(self, color):
        """æ ¹æ®é¢œè‰²è·å–åŠ å·¥å‚æ•°"""
        parameters = {
            'black': {'drill_speed': 1000, 'feed_rate': 100},
            'red': {'drill_speed': 800, 'feed_rate': 80},    # ç‰¹æ®Šå¤„ç†
            'silver': {'drill_speed': 1200, 'feed_rate': 120} # é«˜ç²¾åº¦
        }
        return parameters.get(color, parameters['black'])
```

## ğŸ”§ é—®é¢˜ä¿®å¤ (v1.1.3)

### **ä¿®å¤çš„é—®é¢˜**:
1. **é‡å¤è¡¥æ–™**: æ·»åŠ  `refill_in_progress` æ ‡å¿—é˜²æ­¢å¤šæ¬¡è¡¥æ–™æ“ä½œ
2. **æ—¶æœºé”™è¯¯**: ç¡®ä¿åªåœ¨æ–™ä»“ç©º**ä¸”ç³»ç»Ÿç©ºé—²**æ—¶æ‰èƒ½è¿›è¡Œè¡¥æ–™
3. **å¤šçº¿ç¨‹å†²çª**: ä½¿ç”¨ `pending_refill_timer` ç®¡ç†å®šæ—¶å™¨ï¼Œé¿å…å†²çª
4. **é¢œè‰²åˆ†å¸ƒå¼‚å¸¸**: ä¿®å¤è¡¥æ–™å®Œæˆåé¢œè‰²åˆ†å¸ƒæ›´æ–°é€»è¾‘
5. **æ—¶é—´æ˜¾ç¤º**: ä»¿çœŸæ—¶é—´æ˜¾ç¤ºä¸ºæ•´æ•°ï¼Œä¿æŒå†…éƒ¨è®¡ç®—ç²¾åº¦
6. **çŠ¶æ€æ£€æŸ¥**: æ·»åŠ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ï¼Œé˜²æ­¢è¿è¡Œæ—¶è¡¥æ–™
7. **State 6è¡¥æ–™**: å…è®¸åœ¨æœ€åå·¥ä»¶å¼¹å‡ºå(State 6)è¿›è¡Œè¡¥æ–™

### **è¡¥æ–™å…è®¸æ¡ä»¶** (ä¸¥æ ¼æ£€æŸ¥):
è¡¥æ–™æ“ä½œåªæœ‰åœ¨**æ‰€æœ‰æ¡ä»¶åŒæ—¶æ»¡è¶³**æ—¶æ‰è¢«å…è®¸ï¼š

1. **æ–™ä»“å¿…é¡»ä¸ºç©º**: `S3 = False` (å·¥ä»¶æ•°é‡ = 0)
2. **ç³»ç»ŸçŠ¶æ€å¿…é¡»æ˜¯ä»¥ä¸‹ä¹‹ä¸€**:
   - `State = 0` (ç³»ç»Ÿç©ºé—²çŠ¶æ€)
   - `State = 6 ä¸” S3 = False` (æœ€åå·¥ä»¶å¼¹å‡ºå)
3. **æ— è¡¥æ–™è¿›è¡Œ**: `refill_in_progress = False` (æ²¡æœ‰å…¶ä»–è¡¥æ–™æ“ä½œ)

**åº”ç”¨åœºæ™¯**:
- **ç³»ç»Ÿå¯åŠ¨å‰**: State 0 + æ–™ä»“ç©º
- **æœ€åå·¥ä»¶å¼¹å‡ºå**: State 6 + æ–™ä»“ç©º (çœŸå®å·¥ä¸šåœºæ™¯)

**é”™è¯¯æç¤º**:
- æ–™ä»“éç©º: "Manual refill is only available when magazine is empty"
- çŠ¶æ€é”™è¯¯: "Manual refill only available when system is idle (State 0) or after last workpiece ejected (State 6 with empty magazine)"
- è¡¥æ–™è¿›è¡Œ: "Refill already in progress, please wait"

### **è¡¥æ–™æ—¶é—´è¯´æ˜**:
- **æ“ä½œå‘˜å“åº”æ—¶é—´**: ä»æ–™ä»“ç©ºåˆ°ç‚¹å‡»Manual Refillçš„æ—¶é—´
- **ç‰©ç†è¡¥æ–™æ—¶é—´**: å·¥ä»¶æ•°é‡ Ã— 2ç§’/ä»¶ (æ¨¡æ‹ŸçœŸå®è¡¥æ–™è¿‡ç¨‹)
- **æ€»è¡¥æ–™æ—¶é—´**: å“åº”æ—¶é—´ + ç‰©ç†æ—¶é—´

## ğŸ“Š æ€§èƒ½å½±å“

- **å†…å­˜å¼€é”€**: å¢åŠ çº¦ < 1KB (é¢œè‰²æ•°æ®ç»“æ„)
- **è®¡ç®—å¤æ‚åº¦**: O(n) å…¶ä¸­ n ä¸ºé¢œè‰²ç§ç±»æ•° (é€šå¸¸ â‰¤ 5)
- **ç•Œé¢å“åº”**: æ— æ˜æ˜¾å½±å“
- **æ—¥å¿—å¤§å°**: æ¯æ¡æ—¥å¿—å¢åŠ çº¦ 20-30 å­—ç¬¦
- **è¡¥æ–™ä¿æŠ¤**: é˜²æ­¢é‡å¤æ“ä½œï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§

## ğŸ¯ åº”ç”¨ä»·å€¼

1. **æ•™å­¦æ¼”ç¤º**: æ›´çœŸå®åœ°æ¨¡æ‹Ÿå·¥ä¸šç”Ÿäº§ä¸­çš„å¤šå“ç§ç®¡ç†
2. **ç®—æ³•éªŒè¯**: ä¸ºé¢œè‰²æ£€æµ‹ã€åˆ†æ‹£ç®—æ³•æä¾›æµ‹è¯•å¹³å°
3. **æµç¨‹ä¼˜åŒ–**: ç ”ç©¶ä¸åŒé¢œè‰²é…æ¯”å¯¹ç”Ÿäº§æ•ˆç‡çš„å½±å“
4. **è´¨é‡æ§åˆ¶**: æ¨¡æ‹ŸåŸºäºé¢œè‰²çš„å·®å¼‚åŒ–è´¨é‡æ ‡å‡†

---

**æ›´æ–°æ—¥æœŸ**: 2025å¹´5æœˆ
**ç‰ˆæœ¬**: v1.1.0 (é¢œè‰²ç®¡ç†å¢å¼ºç‰ˆ)
**å…¼å®¹æ€§**: å®Œå…¨å‘åå…¼å®¹ï¼Œç°æœ‰åŠŸèƒ½ä¸å—å½±å“
